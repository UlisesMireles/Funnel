<div class="container-fluid">
  <div class="row">
    <div class="col-12" style="text-align: left;">
      <h3>Administración General de Empresas</h3>
    </div>
    <div class="col-12">
      <div class="row contenedorTabla">
        <!-- Mostrar un indicador de carga si la variable loading es true -->
        <div *ngIf="loading">Cargando...</div>

        <p-table *ngIf="!loading" #dt [stripedRows]="true" [tableStyle]="{ 'min-width': '50rem' }" [value]="empresas" [paginator]="true"
          [rows]="10" [rowsPerPageOptions]="[10, 20, 50]" (onPage)="pageChange($event)" [showCurrentPageReport]="true"
          paginatorPosition="both" [columnResizeMode]="'fit'" [resizableColumns]="true" [scrollable]="true" 
          [first]="first" currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} Registros">
          <ng-template class="divAccionesTabla" #caption>
            <div class="row">
              <div class="col inDivDatatableHeader" style="text-align:right; margin-right:5px">

                <p-button label="" icon="pi pi-refresh" (click)="reset()" severity="secondary"
                  [ngStyle]="{'margin-right': '5px'}" />
                <p-button label="" icon="pi pi-plus" severity="secondary" (click)="inserta()" />
              </div>
            </div>
          </ng-template>

          <ng-template #header>
            <tr class="custom-header">
              <th></th>
              <th pSortableColumn="nombreEmpresa">
                Empresa
              </th>
              <th pSortableColumn="alias" style="width: 5% !important;">Alias</th>
              <th pSortableColumn="urlSitio" style="width: 9% !important;">
                Url Sitio
              </th>
              <th pSortableColumn="administrador" class="custom-width4">
                Administrador
              </th>
              <th pSortableColumn="usuarioAdministrador">
                User Admin
              </th>
              <th pSortableColumn="vInicio">
                Inicio
              </th>
              <th pSortableColumn="vTerminacion">
                Terminación
              </th>
              <th pSortableColumn="nombreLicencia" style="width: 5% !important">
                Licencia
              </th>
              <th pSortableColumn="cantidadUsuarios" style="padding: 0px 5px !important">
                User <br />Lic
              </th>
              <th pSortableColumn="userReal" style="padding: 0px 5px !important">
                User <br />Act
              </th>
              <th pSortableColumn="cantidadOportunidades" style="padding: 0px 5px !important">
                Oport <br />Lic
              </th>
              <th pSortableColumn="oportAct" style="padding: 0px 5px !important">
                Oport <br />Act
              </th>
              <th pSortableColumn="oportEmp" style="padding: 0px 5px !important">
                Oport <br />Reg
              </th>
              <th pSortableColumn="activo">
                Estatus
              </th>
            </tr>
            <tr class="custom-header2">
              <th></th>
              <th>
                <input pInputText type="text" [(ngModel)]="filterEmpresas"
                  (ngModelChange)="updateFilter($event, 'nombreEmpresa')">
              </th>
              <th>
                <input pInputText type="text" [(ngModel)]="filterAlias" (ngModelChange)="updateFilter($event, 'alias')" style="width:95% !important">
              </th>
              <th>
                <input pInputText type="text" [(ngModel)]="filterUrl" style="width:95% !important"
                  (ngModelChange)="updateFilter($event, 'urlSitio')">
              </th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th>
                <input pInputText type="text" [(ngModel)]="filterLicencia" style="width:95% !important"
                  (ngModelChange)="updateFilter($event, 'nombreLicencia')">
              </th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>

              <th>
                <p-select [options]="EstatusDropdown" [(ngModel)]="selectedEstatus" (onChange)="FiltrarPorEstatus()"
                  placeholder="Seleccionar Estatus" [appendTo]="'body'" optionLabel="label" optionValue="value">
                </p-select>
              </th>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="15" class="text-center">No se encontraron registros</td>
            </tr>
          </ng-template>

          <ng-template #body let-empresa>
            <tr class="custom-header3 filas">
              <td>
                <p-button type="button" icon="pi pi-pencil" (click)="actualiza(empresa)" text />
              </td>
              <td style="font-weight: bold;">{{ empresa.nombreEmpresa }}</td>
              <td>{{ empresa.alias }}</td>
              <td>{{ empresa.urlSitio }}</td>
              <td>{{ empresa.administrador }}</td>
              <td>{{ empresa.usuarioAdministrador }}</td>
              <td>{{ empresa.vInicio | date : "shortDate" }}</td>
              <td>{{ empresa.vTerminacion | date : "shortDate" }}</td>
              <td>{{ empresa.nombreLicencia }}</td>
              <td>{{ empresa.cantidadUsuarios }}</td>
              <td>{{ empresa.userReal }}</td>
              <td>{{ empresa.cantidadOportunidades }}</td>
              <td>{{ empresa.oportAct }}</td>
              <td>{{ empresa.oportEmp }}</td>
              <td>{{ empresa.activo === 1 ? "Activo" : "Inactivo" }}</td>
            </tr>
          </ng-template>
          <ng-template #footer>
            <tr class="custom-footer ">
              <td></td>
              <td>Total: {{ getVisibleTotal('nombreEmpresa',dt) }}</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>{{ getVisibleTotal('userReal', dt) }}</td>
              <td></td>
              <td>{{ getVisibleTotal('oportAct', dt) }}</td>
              <td>{{ getVisibleTotal('oportEmp', dt) }}</td>
              <td></td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <p-toast position="center"></p-toast>
    </div>
  </div>
</div>
<app-modal-empresas [(visible)]="modalVisible" [title]="'Editar Datos de '" (closeModal)="onModalClose()"
  (result)="manejarResultado($event)" [insertar]="insertar" [empresa]="empresaSeleccionada" [empresas]="empresas">
</app-modal-empresas>
